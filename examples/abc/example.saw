import "AES.cry";

let {{
// Random numbers and permutations (https://xkcd.com/221/).

p2_1 [x0,x1] = [x0,x1]
p2_2 [x0,x1] = [x1,x0]
p2_3 [x0,x1] = [x0,x1]
p2_4 [x0,x1] = [x0,x1]
r2_1 = 0b10
r2_2 = 0b00

p4_1 [x0,x1,x2,x3] = [x3,x0,x2,x1]
p4_2 [x0,x1,x2,x3] = [x3,x2,x1,x0]
p4_3 [x0,x1,x2,x3] = [x3,x0,x1,x2]
p4_4 [x0,x1,x2,x3] = [x0,x1,x3,x2]
r4_1 = 0b1011
r4_2 = 0b0000

p16_1 [x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15] = [x14,x4,x5,x15,x3,x0,x1,x13,x9,x11,x12,x10,x8,x7,x2,x6]
p16_2 [x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15] = [x0,x9,x4,x3,x6,x14,x2,x12,x10,x7,x13,x5,x11,x15,x1,x8]
p16_3 [x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15] = [x14,x7,x12,x1,x3,x13,x2,x10,x4,x5,x0,x11,x6,x8,x15,x9]
p16_4 [x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15] = [x4,x8,x7,x5,x12,x2,x0,x6,x3,x10,x13,x9,x14,x11,x15,x1]
r16_1 = 0b0010101111000011
r16_2 = 0b1010010100110111

p128_1 [x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15,x16,x17,x18,x19,x20,x21,x22,x23,x24,x25,x26,x27,x28,x29,x30,x31,x32,x33,x34,x35,x36,x37,x38,x39,x40,x41,x42,x43,x44,x45,x46,x47,x48,x49,x50,x51,x52,x53,x54,x55,x56,x57,x58,x59,x60,x61,x62,x63,x64,x65,x66,x67,x68,x69,x70,x71,x72,x73,x74,x75,x76,x77,x78,x79,x80,x81,x82,x83,x84,x85,x86,x87,x88,x89,x90,x91,x92,x93,x94,x95,x96,x97,x98,x99,x100,x101,x102,x103,x104,x105,x106,x107,x108,x109,x110,x111,x112,x113,x114,x115,x116,x117,x118,x119,x120,x121,x122,x123,x124,x125,x126,x127] =
  [x31,x103,x15,x37,x59,x106,x48,x125,x20,x114,x71,x33,x25,x1,x49,x124,x89,x70,x96,x4,x118,x100,x77,x18,x3,x62,x120,x87,x61,x91,x112,x111,x14,x113,x85,x98,x40,x105,x10,x23,x107,x24,x115,x47,x94,x32,x5,x54,x75,x22,x7,x74,x56,x80,x13,x6,x97,x30,x122,x99,x95,x35,x66,x21,x28,x127,x110,x102,x16,x63,x27,x126,x50,x51,x44,x84,x8,x79,x52,x11,x19,x88,x109,x58,x73,x82,x36,x42,x64,x119,x90,x67,x104,x12,x43,x116,x92,x60,x81,x101,x83,x123,x68,x46,x34,x53,x38,x55,x0,x78,x121,x65,x69,x86,x39,x2,x93,x76,x45,x17,x26,x29,x117,x9,x41,x72,x57,x108]

p128_2 [x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15,x16,x17,x18,x19,x20,x21,x22,x23,x24,x25,x26,x27,x28,x29,x30,x31,x32,x33,x34,x35,x36,x37,x38,x39,x40,x41,x42,x43,x44,x45,x46,x47,x48,x49,x50,x51,x52,x53,x54,x55,x56,x57,x58,x59,x60,x61,x62,x63,x64,x65,x66,x67,x68,x69,x70,x71,x72,x73,x74,x75,x76,x77,x78,x79,x80,x81,x82,x83,x84,x85,x86,x87,x88,x89,x90,x91,x92,x93,x94,x95,x96,x97,x98,x99,x100,x101,x102,x103,x104,x105,x106,x107,x108,x109,x110,x111,x112,x113,x114,x115,x116,x117,x118,x119,x120,x121,x122,x123,x124,x125,x126,x127] =
  [x62,x79,x103,x97,x25,x85,x111,x75,x16,x93,x36,x126,x55,x86,x88,x43,x87,x30,x94,x123,x107,x78,x64,x106,x2,x45,x69,x91,x50,x74,x83,x47,x81,x18,x54,x70,x66,x33,x119,x109,x101,x90,x95,x71,x38,x104,x53,x65,x63,x116,x114,x76,x67,x80,x48,x12,x27,x41,x37,x96,x8,x100,x115,x89,x34,x9,x105,x24,x58,x77,x22,x56,x6,x51,x110,x112,x108,x29,x113,x98,x59,x60,x4,x61,x49,x17,x39,x11,x20,x42,x124,x118,x72,x73,x5,x0,x57,x1,x46,x127,x84,x13,x99,x35,x3,x7,x21,x121,x117,x68,x19,x28,x15,x44,x52,x14,x23,x32,x31,x26,x40,x102,x82,x122,x125,x120,x10,x92]

p128_3 [x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15,x16,x17,x18,x19,x20,x21,x22,x23,x24,x25,x26,x27,x28,x29,x30,x31,x32,x33,x34,x35,x36,x37,x38,x39,x40,x41,x42,x43,x44,x45,x46,x47,x48,x49,x50,x51,x52,x53,x54,x55,x56,x57,x58,x59,x60,x61,x62,x63,x64,x65,x66,x67,x68,x69,x70,x71,x72,x73,x74,x75,x76,x77,x78,x79,x80,x81,x82,x83,x84,x85,x86,x87,x88,x89,x90,x91,x92,x93,x94,x95,x96,x97,x98,x99,x100,x101,x102,x103,x104,x105,x106,x107,x108,x109,x110,x111,x112,x113,x114,x115,x116,x117,x118,x119,x120,x121,x122,x123,x124,x125,x126,x127] =
  [x1,x83,x5,x78,x6,x92,x74,x25,x24,x13,x69,x59,x75,x88,x30,x72,x46,x47,x76,x31,x93,x26,x3,x68,x27,x52,x63,x40,x86,x87,x101,x42,x114,x36,x127,x104,x111,x124,x51,x54,x112,x14,x20,x80,x62,x90,x23,x70,x115,x109,x91,x121,x7,x32,x65,x15,x2,x99,x64,x21,x12,x35,x41,x123,x107,x73,x105,x16,x37,x11,x98,x117,x9,x67,x55,x100,x84,x106,x60,x81,x48,x34,x28,x50,x71,x77,x4,x0,x119,x125,x45,x110,x29,x56,x95,x19,x89,x22,x57,x53,x97,x82,x44,x17,x10,x58,x38,x43,x79,x126,x122,x8,x85,x118,x116,x49,x96,x33,x61,x113,x66,x108,x39,x120,x18,x103,x94,x102]

p128_4 [x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15,x16,x17,x18,x19,x20,x21,x22,x23,x24,x25,x26,x27,x28,x29,x30,x31,x32,x33,x34,x35,x36,x37,x38,x39,x40,x41,x42,x43,x44,x45,x46,x47,x48,x49,x50,x51,x52,x53,x54,x55,x56,x57,x58,x59,x60,x61,x62,x63,x64,x65,x66,x67,x68,x69,x70,x71,x72,x73,x74,x75,x76,x77,x78,x79,x80,x81,x82,x83,x84,x85,x86,x87,x88,x89,x90,x91,x92,x93,x94,x95,x96,x97,x98,x99,x100,x101,x102,x103,x104,x105,x106,x107,x108,x109,x110,x111,x112,x113,x114,x115,x116,x117,x118,x119,x120,x121,x122,x123,x124,x125,x126,x127] =
  [x60,x71,x53,x3,x5,x10,x1,x28,x13,x35,x22,x14,x49,x83,x110,x81,x75,x64,x113,x124,x46,x8,x59,x58,x55,x66,x73,x37,x63,x100,x47,x62,x121,x17,x56,x7,x15,x102,x86,x93,x112,x24,x69,x61,x44,x30,x80,x18,x94,x0,x39,x123,x57,x19,x54,x90,x31,x118,x48,x77,x6,x115,x36,x127,x32,x92,x119,x72,x26,x33,x101,x116,x40,x23,x91,x74,x27,x16,x12,x107,x85,x117,x108,x4,x98,x42,x9,x67,x126,x51,x95,x82,x20,x106,x11,x79,x34,x84,x109,x122,x41,x114,x104,x103,x65,x120,x99,x96,x89,x43,x29,x76,x68,x88,x97,x87,x25,x50,x125,x21,x38,x70,x111,x105,x78,x52,x45,x2]

r128_1 = 0b00011001001110100110100110111001001111100001000111110100001000000100000110111000101011110000100011011110001101111010000100010001
r128_2 = 0b01110010010010111001100001000100011000011001010001011000001001110100111100111100010101010100000000001000001000110100101001111100

p256_1 [x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15,x16,x17,x18,x19,x20,x21,x22,x23,x24,x25,x26,x27,x28,x29,x30,x31,x32,x33,x34,x35,x36,x37,x38,x39,x40,x41,x42,x43,x44,x45,x46,x47,x48,x49,x50,x51,x52,x53,x54,x55,x56,x57,x58,x59,x60,x61,x62,x63,x64,x65,x66,x67,x68,x69,x70,x71,x72,x73,x74,x75,x76,x77,x78,x79,x80,x81,x82,x83,x84,x85,x86,x87,x88,x89,x90,x91,x92,x93,x94,x95,x96,x97,x98,x99,x100,x101,x102,x103,x104,x105,x106,x107,x108,x109,x110,x111,x112,x113,x114,x115,x116,x117,x118,x119,x120,x121,x122,x123,x124,x125,x126,x127,x128,x129,x130,x131,x132,x133,x134,x135,x136,x137,x138,x139,x140,x141,x142,x143,x144,x145,x146,x147,x148,x149,x150,x151,x152,x153,x154,x155,x156,x157,x158,x159,x160,x161,x162,x163,x164,x165,x166,x167,x168,x169,x170,x171,x172,x173,x174,x175,x176,x177,x178,x179,x180,x181,x182,x183,x184,x185,x186,x187,x188,x189,x190,x191,x192,x193,x194,x195,x196,x197,x198,x199,x200,x201,x202,x203,x204,x205,x206,x207,x208,x209,x210,x211,x212,x213,x214,x215,x216,x217,x218,x219,x220,x221,x222,x223,x224,x225,x226,x227,x228,x229,x230,x231,x232,x233,x234,x235,x236,x237,x238,x239,x240,x241,x242,x243,x244,x245,x246,x247,x248,x249,x250,x251,x252,x253,x254,x255] =
  [x202,x26,x226,x62,x115,x129,x155,x88,x45,x50,x79,x22,x96,x147,x175,x90,x57,x3,x237,x39,x152,x221,x177,x60,x183,x19,x41,x200,x218,x209,x232,x160,x71,x86,x78,x220,x87,x110,x12,x123,x25,x37,x81,x28,x6,x181,x126,x63,x212,x106,x182,x222,x173,x99,x140,x166,x118,x130,x69,x65,x198,x27,x52,x47,x156,x248,x228,x66,x244,x128,x150,x254,x21,x184,x229,x127,x36,x208,x31,x179,x100,x210,x240,x213,x187,x74,x142,x89,x225,x253,x33,x16,x242,x172,x61,x101,x247,x108,x255,x17,x91,x97,x215,x170,x204,x139,x18,x111,x15,x24,x143,x8,x236,x42,x171,x216,x169,x157,x98,x10,x40,x203,x104,x83,x43,x191,x201,x59,x55,x153,x186,x168,x112,x113,x92,x114,x121,x38,x162,x132,x165,x235,x231,x5,x30,x68,x193,x207,x29,x178,x7,x70,x158,x137,x151,x77,x94,x53,x58,x0,x49,x252,x149,x251,x23,x32,x161,x51,x144,x64,x217,x196,x174,x185,x245,x95,x243,x230,x164,x122,x34,x133,x93,x135,x124,x48,x84,x176,x238,x134,x103,x131,x1,x141,x82,x234,x211,x246,x20,x146,x194,x167,x163,x54,x190,x80,x76,x109,x35,x119,x117,x13,x145,x154,x233,x85,x67,x227,x107,x14,x159,x2,x241,x205,x72,x46,x195,x75,x219,x56,x44,x105,x136,x249,x250,x11,x120,x180,x73,x148,x4,x206,x138,x239,x214,x189,x197,x116,x192,x224,x9,x102,x188,x199,x223,x125]

p256_2 [x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15,x16,x17,x18,x19,x20,x21,x22,x23,x24,x25,x26,x27,x28,x29,x30,x31,x32,x33,x34,x35,x36,x37,x38,x39,x40,x41,x42,x43,x44,x45,x46,x47,x48,x49,x50,x51,x52,x53,x54,x55,x56,x57,x58,x59,x60,x61,x62,x63,x64,x65,x66,x67,x68,x69,x70,x71,x72,x73,x74,x75,x76,x77,x78,x79,x80,x81,x82,x83,x84,x85,x86,x87,x88,x89,x90,x91,x92,x93,x94,x95,x96,x97,x98,x99,x100,x101,x102,x103,x104,x105,x106,x107,x108,x109,x110,x111,x112,x113,x114,x115,x116,x117,x118,x119,x120,x121,x122,x123,x124,x125,x126,x127,x128,x129,x130,x131,x132,x133,x134,x135,x136,x137,x138,x139,x140,x141,x142,x143,x144,x145,x146,x147,x148,x149,x150,x151,x152,x153,x154,x155,x156,x157,x158,x159,x160,x161,x162,x163,x164,x165,x166,x167,x168,x169,x170,x171,x172,x173,x174,x175,x176,x177,x178,x179,x180,x181,x182,x183,x184,x185,x186,x187,x188,x189,x190,x191,x192,x193,x194,x195,x196,x197,x198,x199,x200,x201,x202,x203,x204,x205,x206,x207,x208,x209,x210,x211,x212,x213,x214,x215,x216,x217,x218,x219,x220,x221,x222,x223,x224,x225,x226,x227,x228,x229,x230,x231,x232,x233,x234,x235,x236,x237,x238,x239,x240,x241,x242,x243,x244,x245,x246,x247,x248,x249,x250,x251,x252,x253,x254,x255] =
  [x195,x104,x118,x45,x144,x251,x179,x196,x69,x176,x70,x60,x11,x6,x186,x255,x36,x3,x67,x206,x34,x125,x37,x31,x173,x38,x241,x187,x115,x1,x182,x234,x140,x154,x248,x5,x68,x250,x47,x46,x243,x15,x193,x66,x227,x178,x224,x103,x52,x252,x211,x237,x83,x181,x62,x153,x210,x100,x128,x221,x192,x109,x203,x145,x175,x133,x92,x87,x132,x167,x8,x168,x75,x86,x230,x212,x149,x123,x151,x189,x233,x170,x223,x108,x23,x190,x200,x235,x50,x44,x135,x204,x213,x82,x164,x139,x201,x74,x171,x253,x231,x25,x94,x19,x239,x39,x142,x166,x91,x217,x18,x40,x244,x17,x41,x169,x180,x247,x24,x65,x220,x54,x53,x240,x160,x229,x194,x225,x137,x249,x191,x147,x184,x80,x98,x57,x165,x42,x161,x119,x185,x26,x148,x129,x242,x177,x162,x58,x138,x117,x155,x90,x218,x107,x28,x146,x76,x208,x102,x222,x101,x106,x20,x120,x56,x157,x219,x198,x232,x10,x238,x88,x126,x48,x236,x2,x215,x214,x136,x4,x49,x72,x199,x99,x245,x77,x43,x163,x130,x127,x29,x12,x143,x78,x96,x14,x84,x55,x95,x0,x116,x131,x159,x174,x113,x197,x111,x59,x105,x64,x188,x21,x89,x73,x246,x61,x209,x93,x254,x216,x97,x16,x79,x183,x71,x121,x7,x134,x226,x81,x152,x114,x124,x32,x207,x27,x35,x63,x172,x22,x51,x85,x150,x158,x205,x122,x110,x228,x13,x112,x33,x30,x202,x156,x9,x141]

p256_3 [x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15,x16,x17,x18,x19,x20,x21,x22,x23,x24,x25,x26,x27,x28,x29,x30,x31,x32,x33,x34,x35,x36,x37,x38,x39,x40,x41,x42,x43,x44,x45,x46,x47,x48,x49,x50,x51,x52,x53,x54,x55,x56,x57,x58,x59,x60,x61,x62,x63,x64,x65,x66,x67,x68,x69,x70,x71,x72,x73,x74,x75,x76,x77,x78,x79,x80,x81,x82,x83,x84,x85,x86,x87,x88,x89,x90,x91,x92,x93,x94,x95,x96,x97,x98,x99,x100,x101,x102,x103,x104,x105,x106,x107,x108,x109,x110,x111,x112,x113,x114,x115,x116,x117,x118,x119,x120,x121,x122,x123,x124,x125,x126,x127,x128,x129,x130,x131,x132,x133,x134,x135,x136,x137,x138,x139,x140,x141,x142,x143,x144,x145,x146,x147,x148,x149,x150,x151,x152,x153,x154,x155,x156,x157,x158,x159,x160,x161,x162,x163,x164,x165,x166,x167,x168,x169,x170,x171,x172,x173,x174,x175,x176,x177,x178,x179,x180,x181,x182,x183,x184,x185,x186,x187,x188,x189,x190,x191,x192,x193,x194,x195,x196,x197,x198,x199,x200,x201,x202,x203,x204,x205,x206,x207,x208,x209,x210,x211,x212,x213,x214,x215,x216,x217,x218,x219,x220,x221,x222,x223,x224,x225,x226,x227,x228,x229,x230,x231,x232,x233,x234,x235,x236,x237,x238,x239,x240,x241,x242,x243,x244,x245,x246,x247,x248,x249,x250,x251,x252,x253,x254,x255] =
  [x238,x106,x91,x227,x240,x149,x245,x10,x229,x122,x216,x44,x158,x89,x241,x11,x49,x103,x130,x129,x123,x98,x43,x47,x162,x3,x127,x177,x29,x55,x134,x14,x93,x79,x150,x101,x173,x203,x73,x174,x82,x78,x109,x19,x33,x133,x86,x51,x233,x80,x185,x118,x70,x74,x97,x121,x50,x164,x87,x196,x92,x176,x63,x204,x208,x20,x135,x48,x147,x159,x57,x182,x77,x34,x59,x136,x45,x23,x161,x53,x142,x140,x197,x38,x146,x107,x16,x126,x27,x141,x4,x186,x61,x188,x145,x237,x72,x210,x252,x65,x180,x218,x242,x100,x253,x114,x221,x104,x68,x46,x217,x102,x226,x211,x41,x31,x99,x160,x165,x22,x0,x255,x40,x21,x183,x8,x156,x105,x171,x76,x222,x24,x254,x172,x244,x26,x56,x39,x246,x119,x143,x230,x58,x94,x84,x181,x62,x224,x251,x235,x132,x83,x205,x125,x152,x18,x17,x117,x225,x223,x231,x192,x110,x236,x30,x85,x112,x201,x71,x108,x247,x115,x1,x214,x249,x116,x37,x169,x113,x243,x220,x5,x167,x137,x163,x54,x120,x75,x209,x190,x81,x199,x175,x2,x9,x219,x138,x250,x6,x166,x212,x13,x35,x239,x131,x66,x187,x157,x90,x95,x88,x170,x42,x198,x15,x179,x124,x32,x111,x69,x184,x155,x189,x195,x64,x52,x151,x12,x96,x248,x67,x215,x25,x213,x28,x178,x194,x144,x128,x36,x60,x206,x234,x154,x207,x202,x7,x232,x191,x139,x193,x168,x148,x153,x228,x200]

p256_4 [x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15,x16,x17,x18,x19,x20,x21,x22,x23,x24,x25,x26,x27,x28,x29,x30,x31,x32,x33,x34,x35,x36,x37,x38,x39,x40,x41,x42,x43,x44,x45,x46,x47,x48,x49,x50,x51,x52,x53,x54,x55,x56,x57,x58,x59,x60,x61,x62,x63,x64,x65,x66,x67,x68,x69,x70,x71,x72,x73,x74,x75,x76,x77,x78,x79,x80,x81,x82,x83,x84,x85,x86,x87,x88,x89,x90,x91,x92,x93,x94,x95,x96,x97,x98,x99,x100,x101,x102,x103,x104,x105,x106,x107,x108,x109,x110,x111,x112,x113,x114,x115,x116,x117,x118,x119,x120,x121,x122,x123,x124,x125,x126,x127,x128,x129,x130,x131,x132,x133,x134,x135,x136,x137,x138,x139,x140,x141,x142,x143,x144,x145,x146,x147,x148,x149,x150,x151,x152,x153,x154,x155,x156,x157,x158,x159,x160,x161,x162,x163,x164,x165,x166,x167,x168,x169,x170,x171,x172,x173,x174,x175,x176,x177,x178,x179,x180,x181,x182,x183,x184,x185,x186,x187,x188,x189,x190,x191,x192,x193,x194,x195,x196,x197,x198,x199,x200,x201,x202,x203,x204,x205,x206,x207,x208,x209,x210,x211,x212,x213,x214,x215,x216,x217,x218,x219,x220,x221,x222,x223,x224,x225,x226,x227,x228,x229,x230,x231,x232,x233,x234,x235,x236,x237,x238,x239,x240,x241,x242,x243,x244,x245,x246,x247,x248,x249,x250,x251,x252,x253,x254,x255] =
  [x132,x62,x56,x161,x3,x239,x21,x175,x54,x229,x24,x102,x171,x188,x6,x67,x66,x58,x0,x108,x193,x163,x191,x250,x55,x23,x45,x255,x248,x64,x84,x198,x81,x247,x8,x18,x1,x2,x129,x114,x232,x149,x113,x128,x147,x12,x69,x212,x90,x155,x15,x120,x169,x29,x137,x41,x135,x187,x234,x133,x65,x154,x218,x19,x71,x119,x178,x72,x50,x158,x241,x231,x200,x228,x131,x42,x159,x254,x196,x22,x203,x86,x59,x185,x88,x157,x77,x85,x35,x230,x123,x214,x104,x237,x70,x101,x148,x124,x16,x49,x79,x87,x36,x160,x31,x221,x134,x223,x136,x14,x213,x190,x227,x164,x109,x100,x172,x197,x176,x184,x249,x7,x106,x52,x151,x152,x143,x209,x165,x199,x75,x238,x216,x253,x13,x25,x43,x103,x99,x251,x105,x92,x26,x206,x192,x126,x204,x205,x242,x60,x153,x115,x125,x95,x141,x117,x181,x189,x162,x48,x219,x61,x243,x167,x20,x10,x233,x40,x130,x39,x94,x111,x44,x5,x121,x174,x225,x170,x201,x222,x186,x78,x240,x38,x34,x11,x142,x98,x53,x30,x183,x156,x28,x166,x217,x127,x32,x89,x46,x96,x82,x236,x91,x182,x194,x63,x110,x4,x179,x208,x116,x145,x122,x107,x74,x210,x246,x177,x140,x139,x112,x150,x195,x202,x146,x244,x211,x215,x245,x168,x118,x80,x97,x57,x207,x76,x173,x33,x180,x144,x9,x252,x138,x73,x93,x68,x51,x83,x17,x226,x235,x47,x37,x220,x27,x224]

r256_1 = 0b0010001110011011011010111001001001100010000110001111100101010001011101000100111111101001101010101011111110001000110100011100000111111000000110000001011000110011011111000111111011010001100010000100110010110011010111101111000100001011001100101110010000011011
r256_2 = 0b0110011101001101011101010111000110101001110110101110110100011100111101000000011000101100001001110100100001100110101011011011111001111010110000101111011110111101101010000010011001000000101011010001101100011001110001111001010101000011011110111010110010100001

almost_id magic x = if x == magic then reverse x else x

almost_id_2_1 x = p2_1 (almost_id r2_1 (p2_2 x))
almost_id_2_2 x = p2_3 (almost_id r2_2 (p2_2 x))

almost_id_4_1 x = p4_1 (almost_id r4_1 (p4_2 x))
almost_id_4_2 x = p4_3 (almost_id r4_2 (p4_4 x))

almost_id_16_1 x = p16_1 (almost_id r16_1 (p16_2 x))
almost_id_16_2 x = p16_3 (almost_id r16_2 (p16_4 x))

almost_id_128_1 x = p128_1 (almost_id r128_1 (p128_2 x))
almost_id_128_2 x = p128_3 (almost_id r128_2 (p128_4 x))

almost_id_256_1 x = p256_1 (almost_id r256_1 (p256_2 x))
almost_id_256_2 x = p256_3 (almost_id r256_2 (p256_4 x))

// Copied from ':/LLVM/doc/lss-tutorial/code/aes.saw'.
aesRef x = aesEncrypt (pt, key)
  where [pt,key] = split (join (reverse (groupBy`{32} x)))

permutedAesRef x = p128_1 (flatAesRef (p256_1 x))
  where flatAesRef y = aesEncrypt (pt, key)
          where [pt, key] = split y
}};

let main = do {
  print "Writing aes-ref.aig ...";
  write_aig "aes-ref.aig" {{ aesRef }};

  print "Writing aes-ref.input-not-permuted.aig ...";
  write_aig "aes-ref.input-not-permuted.aig" {{ aesEncrypt }};

  print "Writing aes-ref.io-permuted-randomly.aig ...";
  write_aig "aes-ref.io-permuted-randomly.aig" {{ permutedAesRef }};

  print "Reading aes.aig ...";
  aes_llvm <- read_aig "aes.aig";
  print "Writing aes-llvm.io-permuted-randomly.aig ...";
  write_aig "aes-llvm.io-permuted-randomly.aig"
    {{ \x -> p128_2 (aes_llvm (p256_2 x)) }};

  print "Writing almost-id.2.1.aig";
  write_aig "almost-id.2.1.aig" {{ almost_id_2_1 }};

  print "Writing almost-id.2.2.aig";
  write_aig "almost-id.2.2.aig" {{ almost_id_2_2 }};

  print "Writing almost-id.4.1.aig";
  write_aig "almost-id.4.1.aig" {{ almost_id_4_1 }};

  print "Writing almost-id.4.2.aig";
  write_aig "almost-id.4.2.aig" {{ almost_id_4_2 }};

  print "Writing almost-id.16.1.aig";
  write_aig "almost-id.16.1.aig" {{ almost_id_16_1 }};

  print "Writing almost-id.16.2.aig";
  write_aig "almost-id.16.2.aig" {{ almost_id_16_2 }};

  print "Writing almost-id.128.1.aig";
  write_aig "almost-id.128.1.aig" {{ almost_id_128_1 }};

  print "Writing almost-id.128.2.aig";
  write_aig "almost-id.128.2.aig" {{ almost_id_128_2 }};

  print "Writing almost-id.256.1.aig";
  write_aig "almost-id.256.1.aig" {{ almost_id_256_1 }};

  print "Writing almost-id.256.2.aig";
  write_aig "almost-id.256.2.aig" {{ almost_id_256_2 }};
};
