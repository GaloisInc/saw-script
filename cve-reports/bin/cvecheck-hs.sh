#!/bin/sh
# cvecheck-hs.sh: do CVE checks
# usage: cvecheck-hs.sh

set -e

THIS_DIR=$(realpath $(dirname $0))
TOP_DIR=$(realpath  ${THIS_DIR}/../..)
JSON_FILE=$(realpath ${THIS_DIR}/..)/hs-cves.json
AUDIT_EXE=${TOP_DIR}/bin/cabal-audit

echo
echo "Running cabal-audit, at top level:"

if [ ! -x ${AUDIT_EXE} ] ; then
  echo error: ${AUDIT_EXE} does not exist.
  exit 1
elif [ $# == 0 ] ; then
    ARGS=""
elif [ $# -eq 1 ] && [ $1 = "--write-json" ] ; then
    ARGS="--json -o ${JSON_FILE}"
else
  echo "Usage: cvecheck-hs.sh [--write-json]"
  exit 1
fi

cd ${TOP_DIR}

${AUDIT_EXE} ${ARGS}
