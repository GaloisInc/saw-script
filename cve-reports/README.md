# CVE Checks
## Background.

Here we generate reports for listing any used packages that are
subject to CVEs.  We do this for three languages: Haskell, Rust, and Python.

For background, approach, and useful boilerplate, refer to
  https://github.com/GaloisInc/hello-cve-scans.git

## Prerequisites

First, build the software of interest:
 - sawscript itself
 - doc/rust-tutorial/code/salsa20 (a Rust project)
 - saw-remote-api/python (a Python project)

Ensure you have the following installed (beyond what's required of sawscript):
  * wget

## Quick Start

Run this script to build & install software needed to do the checks:
```
cve-reports/bin/cvecheck-build.sh
```

Run this script to run all three checks, freeform text to stdout:
```
cve-reports/bin/cvecheck-build.sh
```

To generate all three JSON reports (each with their own json structure):
```
cve-reports/bin/cvecheck-build.sh  --write-json
```

Individual reports can be run also:
```
cve-reports/bin/cvecheck-hs.sh               # generate the haskell
cve-reports/bin/cvecheck-hs.sh --write-json  # write the json report
                                             # to `cve-reports/hs-cves.json`
```

A rollup of these three reports can be done with:
```
TODO: YET TO BE DONE!
```

## What we check

We check these three projects
  * top level Haskell project, captured in saw-script.cabal
  * the Python project in `saw-remote-api/python/`.
  * the Rust project in `doc/rust-tutorial/code/salsa20`.

We ignore the projects (packages, etc.) in `dep/`, if any are used in
the above projects, the dependencies should be reflected in the
builds of the above.

NOTE: if further rust or python projects get added, they need to be
added to the scripts.

## Caveats

For further background refer to
  https://github.com/GaloisInc/hello-cve-scans.git
but in a nutshell
  - we may report false positives as **... TODO**
  - we do not check dependencies (see deps/), this

## Further details on the CVE checks for our three languages:
### Haskell: `bin/cvecheck-hs.sh`

We use the MangoIV/cabal-audit package
  https://github.com/MangoIV/cabal-audit.git
which is not to be confused with the `cabal-audit` in hackage.
The latter is hopelessly out of date, while the former

  - is beta quality, but is being maintained
  - calls the cabal libraries and thus (for better or worse), inherits
    the cabal settings and environment.
  - uses the advisories in
    https://github.com/haskell/security-advisories.git
    (this also contains some custom Haskell packages)

Note that the advisory database is checked and downloaded each time
that `cabal-audit` is called.

### Python: `bin/cvecheck-py.sh`

We use the python-audit package.
Since are using poetry, we need to first "extract" a requirements.txt.

### Rust: `bin/cvecheck-rs.sh`

We use the cargo-audit package.
