enable_experimental;

m1 <- yosys_import "shift_dyn_idx.json";
let spec1 = {{ \(x : {idx : [4]}) -> { out = 1 << x.idx : [8] } }};
yosys_verify {{ m1.shift_dyn_idx }} [] spec1 [] z3;

m2 <- yosys_import "shift_dyn_idx_signed.json";
// For signed 4-bit index:
// If MSB (bit 0) is 1, it's negative -> out of bounds -> result 0.
// If MSB is 0, it's 0..7 -> valid index -> result 1 << idx.
let spec2 = {{ \(x : {idx : [4]}) -> { out = if x.idx @ 0 then 0 else 1 << x.idx : [8] } }};
yosys_verify {{ m2.shift_dyn_idx_signed }} [] spec2 [] z3;

m3 <- yosys_import "shift_sshr_trunc.json";
// (small = large >>> n) should match (drop (large >>$ n))
let spec3 = {{ \(x : {a : [16], b : [4]}) -> { out = drop`{8} (x.a >>$ x.b) } }};
yosys_verify {{ m3.shift_sshr_trunc }} [] spec3 [] z3;

m4 <- yosys_import "shift_sshr_ext.json";
// (large = small >>> n) should match (sext small >>$ n)
let spec4 = {{ \(x : {a : [4], b : [4]}) -> { out = (sext x.a : [8]) >>$ x.b } }};
yosys_verify {{ m4.shift_sshr_ext }} [] spec4 [] z3;
