// test.saw

let f_spec_0 = do {
    a_array <- mir_fresh_var "a_array" (mir_array 5 mir_u8);
    a_ref <- mir_ref_of (mir_term a_array);
    mir_execute_func [mir_slice_range_value a_ref 0 2];
    mir_return (mir_term {{ a_array @ 0 }});
};

let f_spec_2 = do {
    a_array <- mir_fresh_var "a_array" (mir_array 5 mir_u8);
    a_ref <- mir_ref_of (mir_term a_array);
    mir_execute_func [mir_slice_range_value a_ref 2 4];
    mir_return (mir_term {{ a_array @ 2 }});
};

let g_spec_correct = do {
    a_array <- mir_fresh_var "a_array" (mir_array 5 mir_u8);
    mir_execute_func [mir_term a_array];
    mir_return (mir_term {{ a_array @ 2 }});
};

let g_spec_wrong = do {
    a_array <- mir_fresh_var "a_array" (mir_array 5 mir_u8);
    mir_execute_func [mir_term a_array];
    mir_return (mir_term {{ a_array @ 0 }});
};

m <- mir_load_module "test.linked-mir.json";

f_ov_0 <- mir_verify m "test::f" [] false f_spec_0 z3;
f_ov_2 <- mir_verify m "test::f" [] false f_spec_2 z3;
mir_verify m "test::g" [] false g_spec_correct z3;
fails (mir_verify m "test::g" [f_ov_0] false g_spec_correct z3);
mir_verify m "test::g" [f_ov_2] false g_spec_correct z3;
fails (mir_verify m "test::g" [f_ov_0] false g_spec_wrong z3);
fails (mir_verify m "test::g" [f_ov_2] false g_spec_wrong z3);
