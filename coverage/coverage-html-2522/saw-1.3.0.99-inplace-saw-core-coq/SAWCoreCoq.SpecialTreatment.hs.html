<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style type="text/css">
span.lineno { color: white; background: #aaaaaa; border-right: solid white 12px }
span.nottickedoff { background: yellow}
span.istickedoff { background: white }
span.tickonlyfalse { margin: -1px; border: 1px solid #f20913; background: #f20913 }
span.tickonlytrue  { margin: -1px; border: 1px solid #60de51; background: #60de51 }
span.funcount { font-size: small; color: orange; z-index: 2; position: absolute; right: 20 }
span.decl { font-weight: bold }
span.spaces    { background: white }
</style>
</head>
<body>
<pre>
<span class="decl"><span class="nottickedoff">never executed</span> <span class="tickonlytrue">always true</span> <span class="tickonlyfalse">always false</span></span>
</pre>
<pre>
<span class="lineno">    1 </span>{-# LANGUAGE ConstraintKinds #-}
<span class="lineno">    2 </span>{-# LANGUAGE FlexibleContexts #-}
<span class="lineno">    3 </span>{-# LANGUAGE FlexibleInstances #-}
<span class="lineno">    4 </span>{-# LANGUAGE GeneralizedNewtypeDeriving #-}
<span class="lineno">    5 </span>{-# LANGUAGE LambdaCase #-}
<span class="lineno">    6 </span>{-# LANGUAGE MultiParamTypeClasses #-}
<span class="lineno">    7 </span>{-# LANGUAGE MultiWayIf #-}
<span class="lineno">    8 </span>{-# LANGUAGE NamedFieldPuns #-}
<span class="lineno">    9 </span>{-# LANGUAGE OverloadedStrings #-}
<span class="lineno">   10 </span>{-# LANGUAGE QuasiQuotes #-}
<span class="lineno">   11 </span>{-# LANGUAGE RankNTypes #-}
<span class="lineno">   12 </span>{-# LANGUAGE RecordWildCards #-}
<span class="lineno">   13 </span>{-# LANGUAGE TemplateHaskell #-}
<span class="lineno">   14 </span>{-# LANGUAGE ViewPatterns #-}
<span class="lineno">   15 </span>
<span class="lineno">   16 </span>{- |
<span class="lineno">   17 </span>Module      : SAWCoreCoq.SpecialTreatment
<span class="lineno">   18 </span>Copyright   : Galois, Inc. 2018
<span class="lineno">   19 </span>License     : BSD3
<span class="lineno">   20 </span>Maintainer  : atomb@galois.com
<span class="lineno">   21 </span>Stability   : experimental
<span class="lineno">   22 </span>Portability : portable
<span class="lineno">   23 </span>-}
<span class="lineno">   24 </span>
<span class="lineno">   25 </span>module SAWCoreCoq.SpecialTreatment where
<span class="lineno">   26 </span>
<span class="lineno">   27 </span>import           Control.Lens                       (_1, _2, over)
<span class="lineno">   28 </span>import           Control.Monad.Reader               (asks)
<span class="lineno">   29 </span>import           Data.Char                          (isAlphaNum)
<span class="lineno">   30 </span>import qualified Data.Map                           as Map
<span class="lineno">   31 </span>import           Data.String.Interpolate            (i)
<span class="lineno">   32 </span>import qualified Data.Text                          as Text
<span class="lineno">   33 </span>import           Prelude                            hiding (fail)
<span class="lineno">   34 </span>import           Text.Encoding.Z                    (zEncodeString)
<span class="lineno">   35 </span>
<span class="lineno">   36 </span>import qualified Language.Coq.AST                   as Coq
<span class="lineno">   37 </span>import           SAWCore.SharedTerm
<span class="lineno">   38 </span>import           SAWCoreCoq.Monad
<span class="lineno">   39 </span>import           SAWCore.Term.Functor
<span class="lineno">   40 </span>
<span class="lineno">   41 </span>data SpecialTreatment = SpecialTreatment
<span class="lineno">   42 </span>  { <span class="nottickedoff"><span class="decl"><span class="nottickedoff">moduleRenaming</span></span></span>        :: Map.Map ModuleName String
<span class="lineno">   43 </span>  , <span class="nottickedoff"><span class="decl"><span class="nottickedoff">identSpecialTreatment</span></span></span> :: Map.Map ModuleName (Map.Map String IdentSpecialTreatment)
<span class="lineno">   44 </span>  }
<span class="lineno">   45 </span>
<span class="lineno">   46 </span>-- | How to handle SAWCore identifiers at their definition sites.
<span class="lineno">   47 </span>data DefSiteTreatment
<span class="lineno">   48 </span>  = -- | Translate the identifier unchanged, and directly translate the assocated
<span class="lineno">   49 </span>    --   SAWCore declaration.
<span class="lineno">   50 </span>    DefPreserve
<span class="lineno">   51 </span>  | -- | Translate the identifier into the given Coq identifer,
<span class="lineno">   52 </span>    --   and otherwise directly translate the associated SAWCore declaration.
<span class="lineno">   53 </span>    DefRename Coq.Ident
<span class="lineno">   54 </span>  | -- | Replace the declaration of the identifier with the given text.
<span class="lineno">   55 </span>    DefReplace  String
<span class="lineno">   56 </span>    -- | Skip the declartion of the identifier altogether.
<span class="lineno">   57 </span>  | DefSkip
<span class="lineno">   58 </span>
<span class="lineno">   59 </span>-- | How to translate SAWCore identifiers at their use sites.
<span class="lineno">   60 </span>data UseSiteTreatment
<span class="lineno">   61 </span>  = -- | Translate the identifier unchanged
<span class="lineno">   62 </span>    UsePreserve
<span class="lineno">   63 </span>    -- | Rename the given identifier into the given (optionally qualified)
<span class="lineno">   64 </span>    --   Coq identifier.  The boolean value, if true, indicates that the
<span class="lineno">   65 </span>    --   identifier should be an &quot;explicit&quot; identifier with a leading \&quot;\@\&quot;
<span class="lineno">   66 </span>    --   symbol, which indicates to Coq that all implicit arguments should be
<span class="lineno">   67 </span>    --   treated as explicit.
<span class="lineno">   68 </span>  | UseRename (Maybe ModuleName) Coq.Ident Bool
<span class="lineno">   69 </span>    -- | Apply a macro function to the translations of the first @n@ SAWCore
<span class="lineno">   70 </span>    -- arguments of this identifier
<span class="lineno">   71 </span>  | UseMacro Int ([Coq.Term] -&gt; Coq.Term)
<span class="lineno">   72 </span>
<span class="lineno">   73 </span>data IdentSpecialTreatment = IdentSpecialTreatment
<span class="lineno">   74 </span>  { <span class="nottickedoff"><span class="decl"><span class="nottickedoff">atDefSite</span></span></span> :: DefSiteTreatment
<span class="lineno">   75 </span>  , <span class="nottickedoff"><span class="decl"><span class="nottickedoff">atUseSite</span></span></span> :: UseSiteTreatment
<span class="lineno">   76 </span>  }
<span class="lineno">   77 </span>
<span class="lineno">   78 </span>moduleRenamingMap :: Map.Map ModuleName ModuleName
<span class="lineno">   79 </span><span class="decl"><span class="nottickedoff">moduleRenamingMap = Map.fromList $</span>
<span class="lineno">   80 </span><span class="spaces">  </span><span class="nottickedoff">over _1 (mkModuleName . (: [])) &lt;$&gt;</span>
<span class="lineno">   81 </span><span class="spaces">  </span><span class="nottickedoff">over _2 (mkModuleName . (: [])) &lt;$&gt;</span>
<span class="lineno">   82 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;Cryptol&quot;, &quot;CryptolPrimitivesForSAWCore&quot;)</span>
<span class="lineno">   83 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Prelude&quot;, &quot;SAWCorePrelude&quot;)</span>
<span class="lineno">   84 </span><span class="spaces">  </span><span class="nottickedoff">]</span></span>
<span class="lineno">   85 </span>
<span class="lineno">   86 </span>translateModuleName :: ModuleName -&gt; ModuleName
<span class="lineno">   87 </span><span class="decl"><span class="nottickedoff">translateModuleName mn =</span>
<span class="lineno">   88 </span><span class="spaces">  </span><span class="nottickedoff">Map.findWithDefault mn mn moduleRenamingMap</span></span>
<span class="lineno">   89 </span>
<span class="lineno">   90 </span>findSpecialTreatment' ::
<span class="lineno">   91 </span>  TranslationConfigurationMonad r m =&gt;
<span class="lineno">   92 </span>  NameInfo -&gt; m IdentSpecialTreatment
<span class="lineno">   93 </span><span class="decl"><span class="nottickedoff">findSpecialTreatment' nmi =</span>
<span class="lineno">   94 </span><span class="spaces">  </span><span class="nottickedoff">case nmi of</span>
<span class="lineno">   95 </span><span class="spaces">    </span><span class="nottickedoff">ModuleIdentifier ident -&gt; findSpecialTreatment ident</span>
<span class="lineno">   96 </span><span class="spaces">    </span><span class="nottickedoff">ImportedName{} -&gt; pure $ IdentSpecialTreatment DefPreserve UsePreserve</span></span>
<span class="lineno">   97 </span>
<span class="lineno">   98 </span>findSpecialTreatment ::
<span class="lineno">   99 </span>  TranslationConfigurationMonad r m =&gt;
<span class="lineno">  100 </span>  Ident -&gt; m IdentSpecialTreatment
<span class="lineno">  101 </span><span class="decl"><span class="nottickedoff">findSpecialTreatment ident = do</span>
<span class="lineno">  102 </span><span class="spaces">  </span><span class="nottickedoff">configuration &lt;- asks translationConfiguration</span>
<span class="lineno">  103 </span><span class="spaces">  </span><span class="nottickedoff">let moduleMap =</span>
<span class="lineno">  104 </span><span class="spaces">        </span><span class="nottickedoff">Map.findWithDefault Map.empty (identModule ident) (specialTreatmentMap configuration)</span>
<span class="lineno">  105 </span><span class="spaces">  </span><span class="nottickedoff">let defaultTreatment =</span>
<span class="lineno">  106 </span><span class="spaces">        </span><span class="nottickedoff">IdentSpecialTreatment</span>
<span class="lineno">  107 </span><span class="spaces">        </span><span class="nottickedoff">{ atDefSite = DefPreserve</span>
<span class="lineno">  108 </span><span class="spaces">        </span><span class="nottickedoff">, atUseSite = UsePreserve</span>
<span class="lineno">  109 </span><span class="spaces">        </span><span class="nottickedoff">}</span>
<span class="lineno">  110 </span><span class="spaces">  </span><span class="nottickedoff">pure $ Map.findWithDefault defaultTreatment (identName ident) moduleMap</span></span>
<span class="lineno">  111 </span>
<span class="lineno">  112 </span>-- | Use `mapsTo` for identifiers whose definition has a matching definition
<span class="lineno">  113 </span>-- already on the Coq side.  As such, their definition can be skipped, and use
<span class="lineno">  114 </span>-- sites can be replaced by the appropriate call.
<span class="lineno">  115 </span>mapsTo :: ModuleName -&gt; Coq.Ident -&gt; IdentSpecialTreatment
<span class="lineno">  116 </span><span class="decl"><span class="nottickedoff">mapsTo targetModule targetName = IdentSpecialTreatment</span>
<span class="lineno">  117 </span><span class="spaces">  </span><span class="nottickedoff">{ atDefSite = DefSkip</span>
<span class="lineno">  118 </span><span class="spaces">  </span><span class="nottickedoff">, atUseSite = UseRename (Just targetModule) targetName False</span>
<span class="lineno">  119 </span><span class="spaces">  </span><span class="nottickedoff">}</span></span>
<span class="lineno">  120 </span>
<span class="lineno">  121 </span>-- | Like 'mapsTo' but use an explicit variable reference so
<span class="lineno">  122 </span>-- that all implicit arguments must be provided.
<span class="lineno">  123 </span>mapsToExpl :: ModuleName -&gt; Coq.Ident -&gt; IdentSpecialTreatment
<span class="lineno">  124 </span><span class="decl"><span class="nottickedoff">mapsToExpl targetModule targetName = IdentSpecialTreatment</span>
<span class="lineno">  125 </span><span class="spaces">  </span><span class="nottickedoff">{ atDefSite = DefSkip</span>
<span class="lineno">  126 </span><span class="spaces">  </span><span class="nottickedoff">, atUseSite = UseRename (Just targetModule) targetName True</span>
<span class="lineno">  127 </span><span class="spaces">  </span><span class="nottickedoff">}</span></span>
<span class="lineno">  128 </span>
<span class="lineno">  129 </span>-- | Like 'mapsToExpl' but add an @n@th argument that is inferred by Coq
<span class="lineno">  130 </span>mapsToExplInferArg :: Coq.Ident -&gt; Int -&gt; IdentSpecialTreatment
<span class="lineno">  131 </span><span class="decl"><span class="nottickedoff">mapsToExplInferArg targetName argNum = IdentSpecialTreatment</span>
<span class="lineno">  132 </span><span class="spaces">  </span><span class="nottickedoff">{ atDefSite = DefSkip</span>
<span class="lineno">  133 </span><span class="spaces">  </span><span class="nottickedoff">, atUseSite = UseMacro argNum (\args -&gt;</span>
<span class="lineno">  134 </span><span class="spaces">                                  </span><span class="nottickedoff">Coq.App (Coq.ExplVar targetName)</span>
<span class="lineno">  135 </span><span class="spaces">                                  </span><span class="nottickedoff">(args ++ [Coq.Var &quot;_&quot;]))</span>
<span class="lineno">  136 </span><span class="spaces">  </span><span class="nottickedoff">}</span></span>
<span class="lineno">  137 </span>
<span class="lineno">  138 </span>-- | Use `realize` for axioms that can be realized, or for primitives that must
<span class="lineno">  139 </span>-- be realized. While some primitives can be written directly in a standalone
<span class="lineno">  140 </span>-- Coq module, some primitives depend on code from the extracted module, and are
<span class="lineno">  141 </span>-- depended upon by following code in the same module. Such primitives can
<span class="lineno">  142 </span>-- therefore *neither* be defined a priori, *nor* a posteriori, and must be
<span class="lineno">  143 </span>-- realized where they were originally declared.
<span class="lineno">  144 </span>realize :: String -&gt; IdentSpecialTreatment
<span class="lineno">  145 </span><span class="decl"><span class="nottickedoff">realize code = IdentSpecialTreatment</span>
<span class="lineno">  146 </span><span class="spaces">  </span><span class="nottickedoff">{ atDefSite = DefReplace code</span>
<span class="lineno">  147 </span><span class="spaces">  </span><span class="nottickedoff">, atUseSite = UsePreserve</span>
<span class="lineno">  148 </span><span class="spaces">  </span><span class="nottickedoff">}</span></span>
<span class="lineno">  149 </span>
<span class="lineno">  150 </span>-- | Use `rename` for identifiers whose definition can be translated, but has to
<span class="lineno">  151 </span>-- be renamed. This is useful for certain definitions whose name on the
<span class="lineno">  152 </span>-- SAWCore/Cryptol side clashes with names on the Coq side. For instance, `at`
<span class="lineno">  153 </span>-- is a reserved Coq keyword, but is used as a function name in SAWCore Prelude.
<span class="lineno">  154 </span>-- Also useful for translation notations, until they are better supported.
<span class="lineno">  155 </span>rename :: Coq.Ident -&gt; IdentSpecialTreatment
<span class="lineno">  156 </span><span class="decl"><span class="nottickedoff">rename ident = IdentSpecialTreatment</span>
<span class="lineno">  157 </span><span class="spaces">  </span><span class="nottickedoff">{ atDefSite = DefRename ident</span>
<span class="lineno">  158 </span><span class="spaces">  </span><span class="nottickedoff">, atUseSite = UseRename Nothing ident False</span>
<span class="lineno">  159 </span><span class="spaces">  </span><span class="nottickedoff">}</span></span>
<span class="lineno">  160 </span>
<span class="lineno">  161 </span>-- | Replace any occurrences of identifier applied to @n@ arguments with the
<span class="lineno">  162 </span>-- supplied Coq term
<span class="lineno">  163 </span>replaceDropArgs :: Int -&gt; Coq.Term -&gt; IdentSpecialTreatment
<span class="lineno">  164 </span><span class="decl"><span class="nottickedoff">replaceDropArgs n term = IdentSpecialTreatment</span>
<span class="lineno">  165 </span><span class="spaces">  </span><span class="nottickedoff">{ atDefSite = DefSkip</span>
<span class="lineno">  166 </span><span class="spaces">  </span><span class="nottickedoff">, atUseSite = UseMacro n (const term)</span>
<span class="lineno">  167 </span><span class="spaces">  </span><span class="nottickedoff">}</span></span>
<span class="lineno">  168 </span>
<span class="lineno">  169 </span>-- | A version of 'replaceDropArgs' that drops no arguments; i.e., just replaces
<span class="lineno">  170 </span>-- an identifier with the supplied Coq term
<span class="lineno">  171 </span>replace :: Coq.Term -&gt; IdentSpecialTreatment
<span class="lineno">  172 </span><span class="decl"><span class="nottickedoff">replace = replaceDropArgs 0</span></span>
<span class="lineno">  173 </span>
<span class="lineno">  174 </span>
<span class="lineno">  175 </span>-- | Use `skip` for identifiers that are already defined in the appropriate
<span class="lineno">  176 </span>-- module on the Coq side.
<span class="lineno">  177 </span>skip :: IdentSpecialTreatment
<span class="lineno">  178 </span><span class="decl"><span class="nottickedoff">skip = IdentSpecialTreatment</span>
<span class="lineno">  179 </span><span class="spaces">  </span><span class="nottickedoff">{ atDefSite = DefSkip</span>
<span class="lineno">  180 </span><span class="spaces">  </span><span class="nottickedoff">, atUseSite = UsePreserve</span>
<span class="lineno">  181 </span><span class="spaces">  </span><span class="nottickedoff">}</span></span>
<span class="lineno">  182 </span>
<span class="lineno">  183 </span>-- | The Coq built-in @Datatypes@ module
<span class="lineno">  184 </span>datatypesModule :: ModuleName
<span class="lineno">  185 </span><span class="decl"><span class="nottickedoff">datatypesModule =</span>
<span class="lineno">  186 </span><span class="spaces">  </span><span class="nottickedoff">mkModuleName [&quot;Coq&quot;, &quot;Init&quot;, &quot;Datatypes&quot;]</span></span>
<span class="lineno">  187 </span>
<span class="lineno">  188 </span>-- | The Coq built-in @Logic@ module
<span class="lineno">  189 </span>logicModule :: ModuleName
<span class="lineno">  190 </span><span class="decl"><span class="nottickedoff">logicModule =</span>
<span class="lineno">  191 </span><span class="spaces">  </span><span class="nottickedoff">mkModuleName [&quot;Coq&quot;, &quot;Init&quot;, &quot;Logic&quot;]</span></span>
<span class="lineno">  192 </span>
<span class="lineno">  193 </span>-- | The Coq built-in @String@ module.
<span class="lineno">  194 </span>stringModule :: ModuleName
<span class="lineno">  195 </span><span class="decl"><span class="nottickedoff">stringModule =</span>
<span class="lineno">  196 </span><span class="spaces">  </span><span class="nottickedoff">mkModuleName [&quot;Coq&quot;, &quot;Strings&quot;, &quot;String&quot;]</span></span>
<span class="lineno">  197 </span>
<span class="lineno">  198 </span>-- | The @SAWCoreScaffolding@ module
<span class="lineno">  199 </span>sawDefinitionsModule :: ModuleName
<span class="lineno">  200 </span><span class="decl"><span class="nottickedoff">sawDefinitionsModule = mkModuleName [&quot;SAWCoreScaffolding&quot;]</span></span>
<span class="lineno">  201 </span>
<span class="lineno">  202 </span>specMModule :: ModuleName
<span class="lineno">  203 </span><span class="decl"><span class="nottickedoff">specMModule = mkModuleName [&quot;SpecM&quot;]</span></span>
<span class="lineno">  204 </span>
<span class="lineno">  205 </span>tpDescModule :: ModuleName
<span class="lineno">  206 </span><span class="decl"><span class="nottickedoff">tpDescModule = mkModuleName [&quot;TpDesc&quot;]</span></span>
<span class="lineno">  207 </span>
<span class="lineno">  208 </span>{-
<span class="lineno">  209 </span>polyListModule :: ModuleName
<span class="lineno">  210 </span>polyListModule = mkModuleName [&quot;PolyList&quot;]
<span class="lineno">  211 </span>-}
<span class="lineno">  212 </span>
<span class="lineno">  213 </span>sawVectorDefinitionsModule :: TranslationConfiguration -&gt; ModuleName
<span class="lineno">  214 </span><span class="decl"><span class="nottickedoff">sawVectorDefinitionsModule (TranslationConfiguration {..}) =</span>
<span class="lineno">  215 </span><span class="spaces">  </span><span class="nottickedoff">mkModuleName [Text.pack vectorModule]</span></span>
<span class="lineno">  216 </span>
<span class="lineno">  217 </span>cryptolPrimitivesModule :: ModuleName
<span class="lineno">  218 </span><span class="decl"><span class="nottickedoff">cryptolPrimitivesModule = mkModuleName [&quot;CryptolPrimitivesForSAWCore&quot;]</span></span>
<span class="lineno">  219 </span>
<span class="lineno">  220 </span>preludeExtraModule :: ModuleName
<span class="lineno">  221 </span><span class="decl"><span class="nottickedoff">preludeExtraModule = mkModuleName [&quot;SAWCorePreludeExtra&quot;]</span></span>
<span class="lineno">  222 </span>
<span class="lineno">  223 </span>specialTreatmentMap :: TranslationConfiguration -&gt;
<span class="lineno">  224 </span>                       Map.Map ModuleName (Map.Map String IdentSpecialTreatment)
<span class="lineno">  225 </span><span class="decl"><span class="nottickedoff">specialTreatmentMap configuration = Map.fromList $</span>
<span class="lineno">  226 </span><span class="spaces">  </span><span class="nottickedoff">over _1 (mkModuleName . (: [])) &lt;$&gt;</span>
<span class="lineno">  227 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;Cryptol&quot;, cryptolPreludeSpecialTreatmentMap)</span>
<span class="lineno">  228 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Prelude&quot;, sawCorePreludeSpecialTreatmentMap configuration)</span>
<span class="lineno">  229 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;SpecM&quot;, specMSpecialTreatmentMap configuration)</span>
<span class="lineno">  230 </span><span class="spaces">  </span><span class="nottickedoff">]</span></span>
<span class="lineno">  231 </span>
<span class="lineno">  232 </span>cryptolPreludeSpecialTreatmentMap :: Map.Map String IdentSpecialTreatment
<span class="lineno">  233 </span><span class="decl"><span class="nottickedoff">cryptolPreludeSpecialTreatmentMap = Map.fromList $ []</span>
<span class="lineno">  234 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  235 </span><span class="spaces">  </span><span class="nottickedoff">-- NOTE: Num has to be defined in the entree-specs library, because it must be</span>
<span class="lineno">  236 </span><span class="spaces">  </span><span class="nottickedoff">-- defined *before* type descriptions, so we have to map Num and some of its</span>
<span class="lineno">  237 </span><span class="spaces">  </span><span class="nottickedoff">-- operations to that library</span>
<span class="lineno">  238 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  239 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;Num&quot;,                   mapsTo tpDescModule &quot;Num&quot;)</span>
<span class="lineno">  240 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;TCNum&quot;,                 mapsTo tpDescModule &quot;TCNum&quot;)</span>
<span class="lineno">  241 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;TCInf&quot;,                 mapsTo tpDescModule &quot;TCInf&quot;)</span>
<span class="lineno">  242 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Num_rec&quot;,               mapsTo tpDescModule &quot;Num_rect&quot;)</span>
<span class="lineno">  243 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;unsafeAssert_same_Num&quot;, skip) -- unsafe and unused</span>
<span class="lineno">  244 </span><span class="spaces">  </span><span class="nottickedoff">]</span></span>
<span class="lineno">  245 </span>
<span class="lineno">  246 </span>-- NOTE: while I initially did the mapping from SAW core names to the
<span class="lineno">  247 </span>-- corresponding Coq construct here, it makes the job of translating SAW core
<span class="lineno">  248 </span>-- axioms into Coq theorems much more annoying, because one needs to manually
<span class="lineno">  249 </span>-- rename every constant mentioned in the statement to its Coq counterpart.
<span class="lineno">  250 </span>-- Instead, I am now trying to keep the names the same as much as possible
<span class="lineno">  251 </span>-- during this translation (it is sometimes impossible, for instance, `at` is a
<span class="lineno">  252 </span>-- reserved keyword in Coq), so that primitives' and axioms' types can be
<span class="lineno">  253 </span>-- copy-pasted as is on the Coq side.
<span class="lineno">  254 </span>sawCorePreludeSpecialTreatmentMap :: TranslationConfiguration -&gt;
<span class="lineno">  255 </span>                                     Map.Map String IdentSpecialTreatment
<span class="lineno">  256 </span><span class="decl"><span class="nottickedoff">sawCorePreludeSpecialTreatmentMap configuration =</span>
<span class="lineno">  257 </span><span class="spaces">  </span><span class="nottickedoff">let vectorsModule = sawVectorDefinitionsModule configuration in</span>
<span class="lineno">  258 </span><span class="spaces">  </span><span class="nottickedoff">Map.fromList $</span>
<span class="lineno">  259 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  260 </span><span class="spaces">  </span><span class="nottickedoff">-- sawLet</span>
<span class="lineno">  261 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;sawLet&quot;, mapsTo sawDefinitionsModule &quot;sawLet_def&quot;) ]</span>
<span class="lineno">  262 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  263 </span><span class="spaces">  </span><span class="nottickedoff">-- Unsafe SAW features</span>
<span class="lineno">  264 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  265 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;error&quot;,             mapsTo sawDefinitionsModule &quot;error&quot;)</span>
<span class="lineno">  266 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;fix&quot;,               skip)</span>
<span class="lineno">  267 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;fix_unfold&quot;,        skip)</span>
<span class="lineno">  268 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;unsafeAssert&quot;,      replaceDropArgs 3 $ Coq.Ltac &quot;solveUnsafeAssert&quot;)</span>
<span class="lineno">  269 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;unsafeAssertBVULt&quot;, replaceDropArgs 3 $ Coq.Ltac &quot;solveUnsafeAssertBVULt&quot;)</span>
<span class="lineno">  270 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;unsafeAssertBVULe&quot;, replaceDropArgs 3 $ Coq.Ltac &quot;solveUnsafeAssertBVULe&quot;)</span>
<span class="lineno">  271 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;unsafeCoerce&quot;,      skip)</span>
<span class="lineno">  272 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;unsafeCoerce_same&quot;, skip)</span>
<span class="lineno">  273 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  274 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  275 </span><span class="spaces">  </span><span class="nottickedoff">-- coercions</span>
<span class="lineno">  276 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  277 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;coerce&quot;,      mapsTo sawDefinitionsModule &quot;coerce&quot;)</span>
<span class="lineno">  278 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;coerce__def&quot;, mapsTo sawDefinitionsModule &quot;coerce&quot;)</span>
<span class="lineno">  279 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;coerce__eq&quot;,  replace (Coq.Var &quot;eq_refl&quot;))</span>
<span class="lineno">  280 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;uip&quot;,         replace (Coq.Var &quot;UIP&quot;))</span>
<span class="lineno">  281 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  282 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  283 </span><span class="spaces">  </span><span class="nottickedoff">-- Unit</span>
<span class="lineno">  284 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  285 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;Unit&quot;,          mapsTo sawDefinitionsModule &quot;Unit&quot;)</span>
<span class="lineno">  286 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;UnitType&quot;,      mapsTo sawDefinitionsModule &quot;UnitType&quot;)</span>
<span class="lineno">  287 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;UnitType__rec&quot;, mapsTo sawDefinitionsModule &quot;UnitType__rec&quot;)</span>
<span class="lineno">  288 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  289 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  290 </span><span class="spaces">  </span><span class="nottickedoff">-- Records</span>
<span class="lineno">  291 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  292 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;EmptyType&quot;,       skip)</span>
<span class="lineno">  293 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;EmptyType__rec&quot;,  skip)</span>
<span class="lineno">  294 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;RecordType&quot;,      skip)</span>
<span class="lineno">  295 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;RecordType__rec&quot;, skip)</span>
<span class="lineno">  296 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  297 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  298 </span><span class="spaces">  </span><span class="nottickedoff">-- Void</span>
<span class="lineno">  299 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  300 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;Void&quot;, mapsTo datatypesModule &quot;Empty_set&quot;)]</span>
<span class="lineno">  301 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  302 </span><span class="spaces">  </span><span class="nottickedoff">-- Decidable equality, does not make sense in Coq unless turned into a type</span>
<span class="lineno">  303 </span><span class="spaces">  </span><span class="nottickedoff">-- class</span>
<span class="lineno">  304 </span><span class="spaces">  </span><span class="nottickedoff">-- Apparently, this is not used much for Cryptol, so we can skip it.</span>
<span class="lineno">  305 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  306 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;eq&quot;,            skip) -- MapsTo $ mkCoqIdent sawDefinitionsModule &quot;eq&quot;)</span>
<span class="lineno">  307 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;eq_bitvector&quot;,  skip)</span>
<span class="lineno">  308 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;eq_Bool&quot;,       skip) -- MapsTo $ mkCoqIdent &quot;CryptolToCoq.SAW&quot; &quot;eq_Bool&quot;)</span>
<span class="lineno">  309 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;eq_Nat&quot;,        skip)</span>
<span class="lineno">  310 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;eq_refl&quot;,       skip) -- MapsTo $ mkCoqIdent &quot;CryptolToCoq.SAW&quot; &quot;eq_refl&quot;)</span>
<span class="lineno">  311 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;eq_VecBool&quot;,    skip)</span>
<span class="lineno">  312 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;eq_VecVec&quot;,     skip)</span>
<span class="lineno">  313 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;ite_eq_cong_1&quot;, skip)</span>
<span class="lineno">  314 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;ite_eq_cong_2&quot;, skip)</span>
<span class="lineno">  315 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  316 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  317 </span><span class="spaces">  </span><span class="nottickedoff">-- Boolean</span>
<span class="lineno">  318 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  319 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;Bool&quot;,          mapsTo datatypesModule &quot;bool&quot;)</span>
<span class="lineno">  320 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;True&quot;,          mapsTo datatypesModule &quot;true&quot;)</span>
<span class="lineno">  321 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;False&quot;,         mapsTo datatypesModule &quot;false&quot;)</span>
<span class="lineno">  322 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;and&quot;,           mapsTo datatypesModule &quot;andb&quot;)</span>
<span class="lineno">  323 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;and__eq&quot;,       mapsTo sawDefinitionsModule &quot;and__eq&quot;)</span>
<span class="lineno">  324 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;or&quot;,            mapsTo datatypesModule &quot;orb&quot;)</span>
<span class="lineno">  325 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;or__eq&quot;,        mapsTo sawDefinitionsModule &quot;or__eq&quot;)</span>
<span class="lineno">  326 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;xor&quot;,           mapsTo datatypesModule &quot;xorb&quot;)</span>
<span class="lineno">  327 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;xor__eq&quot;,       mapsTo sawDefinitionsModule &quot;xor__eq&quot;)</span>
<span class="lineno">  328 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;not&quot;,           mapsTo datatypesModule &quot;negb&quot;)</span>
<span class="lineno">  329 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;not__eq&quot;,       mapsTo sawDefinitionsModule &quot;not__eq&quot;)</span>
<span class="lineno">  330 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;boolEq&quot;,        mapsTo sawDefinitionsModule &quot;boolEq&quot;)</span>
<span class="lineno">  331 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;boolEq__eq&quot;,    mapsTo sawDefinitionsModule &quot;boolEq__eq&quot;)</span>
<span class="lineno">  332 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;ite&quot;,           mapsTo sawDefinitionsModule &quot;ite&quot;)</span>
<span class="lineno">  333 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;iteDep&quot;,        mapsTo sawDefinitionsModule &quot;iteDep&quot;)</span>
<span class="lineno">  334 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;iteDep_True&quot;,   mapsTo sawDefinitionsModule &quot;iteDep_True&quot;)</span>
<span class="lineno">  335 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;iteDep_False&quot;,  mapsTo sawDefinitionsModule &quot;iteDep_False&quot;)</span>
<span class="lineno">  336 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;ite_bit&quot;,       skip) -- FIXME: change this</span>
<span class="lineno">  337 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;ite_eq_iteDep&quot;, mapsTo sawDefinitionsModule &quot;ite_eq_iteDep&quot;)</span>
<span class="lineno">  338 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  339 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  340 </span><span class="spaces">  </span><span class="nottickedoff">-- Pairs</span>
<span class="lineno">  341 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  342 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;PairType&quot;,  mapsTo sawDefinitionsModule &quot;PairType&quot;)</span>
<span class="lineno">  343 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;PairValue&quot;, mapsTo sawDefinitionsModule &quot;PairValue&quot;)</span>
<span class="lineno">  344 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Pair__rec&quot;, mapsTo sawDefinitionsModule &quot;Pair__rec&quot;)</span>
<span class="lineno">  345 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;fst&quot;,       replaceDropArgs 2 $ Coq.Var &quot;fst&quot;)</span>
<span class="lineno">  346 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;snd&quot;,       replaceDropArgs 2 $ Coq.Var &quot;snd&quot;)</span>
<span class="lineno">  347 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  348 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  349 </span><span class="spaces">  </span><span class="nottickedoff">-- Equality</span>
<span class="lineno">  350 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  351 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;Eq&quot;,      mapsToExpl logicModule &quot;eq&quot;)</span>
<span class="lineno">  352 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Eq__rec&quot;, mapsTo sawDefinitionsModule &quot;Eq__rec&quot;)</span>
<span class="lineno">  353 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Refl&quot;,    mapsToExpl logicModule &quot;eq_refl&quot;)</span>
<span class="lineno">  354 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  355 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  356 </span><span class="spaces">  </span><span class="nottickedoff">-- Nat le/lt</span>
<span class="lineno">  357 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  358 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;IsLeNat&quot;     , mapsTo sawDefinitionsModule &quot;IsLeNat&quot;)</span>
<span class="lineno">  359 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;IsLeNat__rec&quot;, mapsTo sawDefinitionsModule &quot;IsLeNat__rec&quot;)</span>
<span class="lineno">  360 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;IsLeNat_base&quot;, mapsTo sawDefinitionsModule &quot;IsLeNat_base&quot;)</span>
<span class="lineno">  361 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;IsLeNat_succ&quot;, mapsTo sawDefinitionsModule &quot;IsLeNat_succ&quot;)</span>
<span class="lineno">  362 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;IsLtNat&quot;     , mapsTo sawDefinitionsModule &quot;IsLtNat&quot;)</span>
<span class="lineno">  363 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  364 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  365 </span><span class="spaces">  </span><span class="nottickedoff">-- Strings</span>
<span class="lineno">  366 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  367 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;String&quot;, mapsTo stringModule &quot;string&quot;)</span>
<span class="lineno">  368 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;equalString&quot;, mapsTo sawDefinitionsModule &quot;equalString&quot;)</span>
<span class="lineno">  369 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;appendString&quot;, mapsTo sawDefinitionsModule &quot;appendString&quot;)</span>
<span class="lineno">  370 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  371 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  372 </span><span class="spaces">  </span><span class="nottickedoff">-- Utility functions</span>
<span class="lineno">  373 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  374 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;id&quot;, mapsTo datatypesModule &quot;id&quot;)</span>
<span class="lineno">  375 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  376 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  377 </span><span class="spaces">  </span><span class="nottickedoff">-- Natural numbers</span>
<span class="lineno">  378 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  379 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;divModNat&quot;, mapsTo sawDefinitionsModule &quot;divModNat&quot;)</span>
<span class="lineno">  380 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Nat&quot;,       mapsTo datatypesModule &quot;nat&quot;)</span>
<span class="lineno">  381 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;widthNat&quot;,  mapsTo sawDefinitionsModule &quot;widthNat&quot;)</span>
<span class="lineno">  382 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Zero&quot;,      mapsTo sawDefinitionsModule &quot;Zero&quot;)</span>
<span class="lineno">  383 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Succ&quot;,      mapsTo sawDefinitionsModule &quot;Succ&quot;)</span>
<span class="lineno">  384 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;addNat&quot;,    mapsTo sawDefinitionsModule &quot;addNat&quot;)</span>
<span class="lineno">  385 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;mulNat&quot;,    mapsTo sawDefinitionsModule &quot;mulNat&quot;)</span>
<span class="lineno">  386 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  387 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  388 </span><span class="spaces">  </span><span class="nottickedoff">-- Vectors</span>
<span class="lineno">  389 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  390 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;EmptyVec&quot;,      mapsTo vectorsModule &quot;EmptyVec&quot;)</span>
<span class="lineno">  391 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;at&quot;,            rename &quot;sawAt&quot;) -- `at` is a reserved keyword in Coq</span>
<span class="lineno">  392 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;at_gen_BVVec&quot;,  mapsTo preludeExtraModule &quot;at_gen_BVVec&quot;)</span>
<span class="lineno">  393 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;atWithDefault&quot;, mapsTo vectorsModule &quot;atWithDefault&quot;)</span>
<span class="lineno">  394 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;atWithProof&quot;,   mapsTo vectorsModule &quot;atWithProof&quot;)</span>
<span class="lineno">  395 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;at_single&quot;,     skip) -- is boring, could be proved on the Coq side</span>
<span class="lineno">  396 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvAdd&quot;,         mapsTo vectorsModule &quot;bvAdd&quot;)</span>
<span class="lineno">  397 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvLg2&quot;,         mapsTo vectorsModule &quot;bvLg2&quot;)</span>
<span class="lineno">  398 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvMul&quot;,         mapsTo vectorsModule &quot;bvMul&quot;)</span>
<span class="lineno">  399 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvNat&quot;,         mapsTo vectorsModule &quot;bvNat&quot;)</span>
<span class="lineno">  400 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvNeg&quot;,         mapsTo vectorsModule &quot;bvNeg&quot;)</span>
<span class="lineno">  401 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvSDiv&quot;,        mapsTo vectorsModule &quot;bvSDiv&quot;)</span>
<span class="lineno">  402 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvSRem&quot;,        mapsTo vectorsModule &quot;bvSRem&quot;)</span>
<span class="lineno">  403 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvSShr&quot;,        mapsTo vectorsModule &quot;bvSShr&quot;)</span>
<span class="lineno">  404 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvSub&quot;,         mapsTo vectorsModule &quot;bvSub&quot;)</span>
<span class="lineno">  405 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvToNat&quot;,       mapsTo vectorsModule &quot;bvToNat&quot;)</span>
<span class="lineno">  406 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvUDiv&quot;,        mapsTo vectorsModule &quot;bvUDiv&quot;)</span>
<span class="lineno">  407 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvURem&quot;,        mapsTo vectorsModule &quot;bvURem&quot;)</span>
<span class="lineno">  408 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvsge&quot;,         mapsTo vectorsModule &quot;bvsge&quot;)</span>
<span class="lineno">  409 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvsgt&quot;,         mapsTo vectorsModule &quot;bvsgt&quot;)</span>
<span class="lineno">  410 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvsle&quot;,         mapsTo vectorsModule &quot;bvsle&quot;)</span>
<span class="lineno">  411 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvslt&quot;,         mapsTo vectorsModule &quot;bvslt&quot;)</span>
<span class="lineno">  412 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvult&quot;,         mapsTo vectorsModule &quot;bvult&quot;)</span>
<span class="lineno">  413 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvule&quot;,         mapsTo vectorsModule &quot;bvule&quot;)</span>
<span class="lineno">  414 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;coerceVec&quot;,     mapsTo vectorsModule &quot;coerceVec&quot;)</span>
<span class="lineno">  415 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;eq_Vec&quot;,        skip)</span>
<span class="lineno">  416 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;foldr&quot;,         mapsTo vectorsModule &quot;foldr&quot;)</span>
<span class="lineno">  417 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;foldr_nil&quot;,     mapsTo vectorsModule &quot;foldr_nil&quot;)</span>
<span class="lineno">  418 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;foldr_cons&quot;,    mapsTo vectorsModule &quot;foldr_cons&quot;)</span>
<span class="lineno">  419 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;foldl&quot;,         mapsTo vectorsModule &quot;foldl&quot;)</span>
<span class="lineno">  420 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;foldl_nil&quot;,     mapsTo vectorsModule &quot;foldl_nil&quot;)</span>
<span class="lineno">  421 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;foldl_cons&quot;,    mapsTo vectorsModule &quot;foldl_cons&quot;)</span>
<span class="lineno">  422 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;gen_at_BVVec&quot;,  mapsTo preludeExtraModule &quot;gen_at_BVVec&quot;)</span>
<span class="lineno">  423 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;genWithProof&quot;,  mapsTo vectorsModule &quot;genWithProof&quot;)</span>
<span class="lineno">  424 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;scanl&quot;,         mapsTo vectorsModule &quot;scanl&quot;)</span>
<span class="lineno">  425 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;gen&quot;,           mapsTo vectorsModule &quot;gen&quot;)</span>
<span class="lineno">  426 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;rotateL&quot;,       mapsTo vectorsModule &quot;rotateL&quot;)</span>
<span class="lineno">  427 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;rotateR&quot;,       mapsTo vectorsModule &quot;rotateR&quot;)</span>
<span class="lineno">  428 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;shiftL&quot;,        mapsTo vectorsModule &quot;shiftL&quot;)</span>
<span class="lineno">  429 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;shiftR&quot;,        mapsTo vectorsModule &quot;shiftR&quot;)</span>
<span class="lineno">  430 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;take0&quot;,         skip)</span>
<span class="lineno">  431 </span><span class="spaces">  </span><span class="nottickedoff">-- zip must be realized in-place because it both depends on definitions and is</span>
<span class="lineno">  432 </span><span class="spaces">  </span><span class="nottickedoff">-- used by other definitions in the same file, so it can neither be pre- nor</span>
<span class="lineno">  433 </span><span class="spaces">  </span><span class="nottickedoff">-- post-defined.</span>
<span class="lineno">  434 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;zip&quot;,           realize zipSnippet)</span>
<span class="lineno">  435 </span><span class="spaces">  </span><span class="nottickedoff">-- cannot map directly to Vector.t because arguments are in a different order</span>
<span class="lineno">  436 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Vec&quot;,           mapsTo vectorsModule &quot;Vec&quot;)</span>
<span class="lineno">  437 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;head&quot;,          mapsTo vectorsModule &quot;head&quot;)</span>
<span class="lineno">  438 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;tail&quot;,          mapsTo vectorsModule &quot;tail&quot;)</span>
<span class="lineno">  439 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;head_gen&quot;,      mapsTo vectorsModule &quot;head_gen&quot;)</span>
<span class="lineno">  440 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;tail_gen&quot;,      mapsTo vectorsModule &quot;tail_gen&quot;)</span>
<span class="lineno">  441 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  442 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  443 </span><span class="spaces">  </span><span class="nottickedoff">-- Streams</span>
<span class="lineno">  444 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  445 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;streamScanl&quot;,   mapsTo preludeExtraModule &quot;streamScanl&quot;)</span>
<span class="lineno">  446 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  447 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  448 </span><span class="spaces">  </span><span class="nottickedoff">-- Integers</span>
<span class="lineno">  449 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  450 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;Integer&quot;,  mapsTo sawDefinitionsModule &quot;Integer&quot;)</span>
<span class="lineno">  451 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intAdd&quot;,   mapsTo sawDefinitionsModule &quot;intAdd&quot;)</span>
<span class="lineno">  452 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intSub&quot;,   mapsTo sawDefinitionsModule &quot;intSub&quot;)</span>
<span class="lineno">  453 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intMul&quot;,   mapsTo sawDefinitionsModule &quot;intMul&quot;)</span>
<span class="lineno">  454 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intDiv&quot;,   mapsTo sawDefinitionsModule &quot;intDiv&quot;)</span>
<span class="lineno">  455 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intMod&quot;,   mapsTo sawDefinitionsModule &quot;intMod&quot;)</span>
<span class="lineno">  456 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intMin&quot;,   mapsTo sawDefinitionsModule &quot;intMin&quot;)</span>
<span class="lineno">  457 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intMax&quot;,   mapsTo sawDefinitionsModule &quot;intMax&quot;)</span>
<span class="lineno">  458 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intNeg&quot;,   mapsTo sawDefinitionsModule &quot;intNeg&quot;)</span>
<span class="lineno">  459 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intAbs&quot;,   mapsTo sawDefinitionsModule &quot;intAbs&quot;)</span>
<span class="lineno">  460 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intEq&quot;,    mapsTo sawDefinitionsModule &quot;intEq&quot;)</span>
<span class="lineno">  461 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intLe&quot;,    mapsTo sawDefinitionsModule &quot;intLe&quot;)</span>
<span class="lineno">  462 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intLt&quot;,    mapsTo sawDefinitionsModule &quot;intLt&quot;)</span>
<span class="lineno">  463 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intToNat&quot;, mapsTo sawDefinitionsModule &quot;intToNat&quot;)</span>
<span class="lineno">  464 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;natToInt&quot;, mapsTo sawDefinitionsModule &quot;natToInt&quot;)</span>
<span class="lineno">  465 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intToBv&quot;,  mapsTo vectorsModule &quot;intToBv&quot;)</span>
<span class="lineno">  466 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvToInt&quot;,  mapsTo vectorsModule &quot;bvToInt&quot;)</span>
<span class="lineno">  467 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;sbvToInt&quot;, mapsTo vectorsModule &quot;sbvToInt&quot;)</span>
<span class="lineno">  468 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  469 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  470 </span><span class="spaces">  </span><span class="nottickedoff">-- Modular integers</span>
<span class="lineno">  471 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  472 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;IntMod&quot;,     mapsTo sawDefinitionsModule &quot;IntMod&quot;)</span>
<span class="lineno">  473 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;toIntMod&quot;,   mapsTo sawDefinitionsModule &quot;toIntMod&quot;)</span>
<span class="lineno">  474 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;fromIntMod&quot;, mapsTo sawDefinitionsModule &quot;fromIntMod&quot;)</span>
<span class="lineno">  475 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intModEq&quot;,   mapsTo sawDefinitionsModule &quot;intModEq&quot;)</span>
<span class="lineno">  476 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intModAdd&quot;,  mapsTo sawDefinitionsModule &quot;intModAdd&quot;)</span>
<span class="lineno">  477 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intModSub&quot;,  mapsTo sawDefinitionsModule &quot;intModSub&quot;)</span>
<span class="lineno">  478 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intModMul&quot;,  mapsTo sawDefinitionsModule &quot;intModMul&quot;)</span>
<span class="lineno">  479 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;intModNeg&quot;,  mapsTo sawDefinitionsModule &quot;intModNeg&quot;)</span>
<span class="lineno">  480 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  481 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  482 </span><span class="spaces">  </span><span class="nottickedoff">-- Axioms currently skipped</span>
<span class="lineno">  483 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  484 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;drop0&quot;,                skip)</span>
<span class="lineno">  485 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvugt&quot;,                skip)</span>
<span class="lineno">  486 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvuge&quot;,                skip)</span>
<span class="lineno">  487 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvPopcount&quot;,           skip)</span>
<span class="lineno">  488 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvCountLeadingZeros&quot;,  skip)</span>
<span class="lineno">  489 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvCountTrailingZeros&quot;, skip)</span>
<span class="lineno">  490 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvForall&quot;,             skip)</span>
<span class="lineno">  491 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvAddZeroL&quot;,           skip)</span>
<span class="lineno">  492 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvAddZeroR&quot;,           skip)</span>
<span class="lineno">  493 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvShl&quot;,                mapsTo vectorsModule &quot;bvShl&quot;)</span>
<span class="lineno">  494 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvShr&quot;,                mapsTo vectorsModule &quot;bvShr&quot;)</span>
<span class="lineno">  495 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvShiftL_bvShl&quot;,       skip)</span>
<span class="lineno">  496 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvShiftR_bvShr&quot;,       skip)</span>
<span class="lineno">  497 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bvEq_refl&quot;,            skip)</span>
<span class="lineno">  498 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;equalNat_bv&quot;,          skip)</span>
<span class="lineno">  499 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Float&quot;,                skip)</span>
<span class="lineno">  500 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;mkFloat&quot;,              skip)</span>
<span class="lineno">  501 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Double&quot;,               skip)</span>
<span class="lineno">  502 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;mkDouble&quot;,             skip)</span>
<span class="lineno">  503 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bveq_sameL&quot;,           skip)</span>
<span class="lineno">  504 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bveq_sameR&quot;,           skip)</span>
<span class="lineno">  505 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bveq_same2&quot;,           skip)</span>
<span class="lineno">  506 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;ite_split_cong&quot;,       skip)</span>
<span class="lineno">  507 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;ite_join_cong&quot;,        skip)</span>
<span class="lineno">  508 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;map_map&quot;,              skip)</span>
<span class="lineno">  509 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;test_fun0&quot;,            skip)</span>
<span class="lineno">  510 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;test_fun1&quot;,            skip)</span>
<span class="lineno">  511 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;test_fun2&quot;,            skip)</span>
<span class="lineno">  512 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;test_fun3&quot;,            skip)</span>
<span class="lineno">  513 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;test_fun4&quot;,            skip)</span>
<span class="lineno">  514 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;test_fun5&quot;,            skip)</span>
<span class="lineno">  515 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;test_fun6&quot;,            skip)</span>
<span class="lineno">  516 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  517 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  518 </span><span class="spaces">  </span><span class="nottickedoff">-- Either</span>
<span class="lineno">  519 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  520 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;Either&quot;,     mapsTo datatypesModule &quot;sum&quot;)</span>
<span class="lineno">  521 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Left&quot;,       mapsToExpl datatypesModule &quot;inl&quot;)</span>
<span class="lineno">  522 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Right&quot;,       mapsToExpl datatypesModule &quot;inr&quot;)</span>
<span class="lineno">  523 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  524 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  525 </span><span class="spaces">  </span><span class="nottickedoff">-- Dependent pairs</span>
<span class="lineno">  526 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  527 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;Sigma&quot;, replace (Coq.ExplVar &quot;sigT&quot;))</span>
<span class="lineno">  528 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;exists&quot;, replace (Coq.ExplVar &quot;existT&quot;))</span>
<span class="lineno">  529 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Sigma__rec&quot;, replace (Coq.ExplVar &quot;sigT_rect&quot;))</span>
<span class="lineno">  530 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Sigma_proj1&quot;, replace (Coq.ExplVar &quot;projT1&quot;))</span>
<span class="lineno">  531 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Sigma_proj2&quot;, replace (Coq.ExplVar &quot;projT2&quot;))</span>
<span class="lineno">  532 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  533 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  534 </span><span class="spaces">  </span><span class="nottickedoff">-- Lists</span>
<span class="lineno">  535 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  536 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;List&quot;, mapsToExpl datatypesModule &quot;list&quot;)</span>
<span class="lineno">  537 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Nil&quot;, mapsToExpl datatypesModule &quot;nil&quot;)</span>
<span class="lineno">  538 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Cons&quot;, mapsToExpl datatypesModule &quot;cons&quot;)</span>
<span class="lineno">  539 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;List__rec&quot;, mapsToExpl datatypesModule &quot;list_rect&quot;)</span>
<span class="lineno">  540 </span><span class="spaces">  </span><span class="nottickedoff">]</span></span>
<span class="lineno">  541 </span>
<span class="lineno">  542 </span>  -- Lists at sort 1
<span class="lineno">  543 </span>  {- FIXME: in order to support lists at a higher sort, we need a universe
<span class="lineno">  544 </span>     polymorphic version of them
<span class="lineno">  545 </span>  ++
<span class="lineno">  546 </span>  [ (&quot;List1&quot;, mapsToExpl polyListModule &quot;plist&quot;)
<span class="lineno">  547 </span>  , (&quot;Nil1&quot;, mapsToExpl polyListModule &quot;pnil&quot;)
<span class="lineno">  548 </span>  , (&quot;Cons1&quot;, mapsToExpl polyListModule &quot;pcons&quot;)
<span class="lineno">  549 </span>  ]
<span class="lineno">  550 </span>  -}
<span class="lineno">  551 </span>
<span class="lineno">  552 </span>specMSpecialTreatmentMap :: TranslationConfiguration -&gt;
<span class="lineno">  553 </span>                            Map.Map String IdentSpecialTreatment
<span class="lineno">  554 </span><span class="decl"><span class="nottickedoff">specMSpecialTreatmentMap _configuration =</span>
<span class="lineno">  555 </span><span class="spaces">  </span><span class="nottickedoff">Map.fromList $</span>
<span class="lineno">  556 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  557 </span><span class="spaces">  </span><span class="nottickedoff">-- Type descriptions</span>
<span class="lineno">  558 </span><span class="spaces">  </span><span class="nottickedoff">map (\str -&gt; (str, mapsTo specMModule (Coq.Ident str)))</span>
<span class="lineno">  559 </span><span class="spaces">  </span><span class="nottickedoff">[ &quot;ExprKind&quot;, &quot;Kind_unit&quot;, &quot;Kind_bool&quot;, &quot;Kind_nat&quot;, &quot;Kind_bv&quot;</span>
<span class="lineno">  560 </span><span class="spaces">  </span><span class="nottickedoff">, &quot;TpExprUnOp&quot;, &quot;UnOp_BVToNat&quot;, &quot;UnOp_NatToBV&quot;</span>
<span class="lineno">  561 </span><span class="spaces">  </span><span class="nottickedoff">, &quot;TpExprBinOp&quot;, &quot;BinOp_AddNat&quot;, &quot;BinOp_MulNat&quot;, &quot;BinOp_AddBV&quot;, &quot;BinOp_MulBV&quot;</span>
<span class="lineno">  562 </span><span class="spaces">  </span><span class="nottickedoff">, &quot;KindDesc&quot;, &quot;Kind_Expr&quot;, &quot;Kind_Tp&quot;</span>
<span class="lineno">  563 </span><span class="spaces">  </span><span class="nottickedoff">, &quot;TpExpr&quot;, &quot;TpExpr_Const&quot;, &quot;TpExpr_Var&quot;, &quot;TpExpr_UnOp&quot;, &quot;TpExpr_BinOp&quot;</span>
<span class="lineno">  564 </span><span class="spaces">  </span><span class="nottickedoff">, &quot;TpDesc&quot;, &quot;Tp_M&quot;, &quot;Tp_Pi&quot;, &quot;Tp_Arr&quot;, &quot;Tp_Kind&quot;, &quot;Tp_Pair&quot;, &quot;Tp_Sum&quot;</span>
<span class="lineno">  565 </span><span class="spaces">  </span><span class="nottickedoff">, &quot;Tp_Sigma&quot;, &quot;Tp_Seq&quot;, &quot;Tp_Void&quot;, &quot;Tp_Ind&quot;, &quot;Tp_Var&quot;, &quot;Tp_TpSubst&quot;</span>
<span class="lineno">  566 </span><span class="spaces">  </span><span class="nottickedoff">, &quot;Tp_ExprSubst&quot;</span>
<span class="lineno">  567 </span><span class="spaces">  </span><span class="nottickedoff">, &quot;tpSubst&quot;, &quot;elimTpEnvElem&quot;, &quot;tpElemEnv&quot;</span>
<span class="lineno">  568 </span><span class="spaces">  </span><span class="nottickedoff">, &quot;indElem&quot;, &quot;indToTpElem&quot;, &quot;tpToIndElem&quot;</span>
<span class="lineno">  569 </span><span class="spaces">  </span><span class="nottickedoff">, &quot;FunFlag&quot;, &quot;IsFun&quot;, &quot;IsData&quot;</span>
<span class="lineno">  570 </span><span class="spaces">  </span><span class="nottickedoff">]</span>
<span class="lineno">  571 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  572 </span><span class="spaces">  </span><span class="nottickedoff">-- The specification monad</span>
<span class="lineno">  573 </span><span class="spaces">  </span><span class="nottickedoff">++</span>
<span class="lineno">  574 </span><span class="spaces">  </span><span class="nottickedoff">[ (&quot;EvType&quot;,               mapsTo specMModule &quot;EvType&quot;)</span>
<span class="lineno">  575 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;Build_EvType&quot;,         mapsTo specMModule &quot;Build_EvType&quot;)</span>
<span class="lineno">  576 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;evTypeType&quot;,           mapsTo specMModule &quot;evTypeType&quot;)</span>
<span class="lineno">  577 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;evRetType&quot;,            mapsTo specMModule &quot;evRetType&quot;)</span>
<span class="lineno">  578 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;SpecM&quot;,                mapsTo specMModule &quot;SpecM&quot;)</span>
<span class="lineno">  579 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;retS&quot;,                 mapsToExpl specMModule &quot;retS&quot;)</span>
<span class="lineno">  580 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;bindS&quot;,                mapsToExpl specMModule &quot;bindS&quot;)</span>
<span class="lineno">  581 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;triggerS&quot;,             mapsToExpl specMModule &quot;triggerS&quot;)</span>
<span class="lineno">  582 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;errorS&quot;,               mapsToExpl specMModule &quot;errorS&quot;)</span>
<span class="lineno">  583 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;forallS&quot;,              mapsToExplInferArg &quot;SpecM.forallS&quot; 2)</span>
<span class="lineno">  584 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;existsS&quot;,              mapsToExplInferArg &quot;SpecM.existsS&quot; 2)</span>
<span class="lineno">  585 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;assumeS&quot;,              mapsToExpl specMModule &quot;assumeS&quot;)</span>
<span class="lineno">  586 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;assertS&quot;,              mapsToExpl specMModule &quot;assertS&quot;)</span>
<span class="lineno">  587 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;FixS&quot;,                 mapsToExpl specMModule &quot;FixS&quot;)</span>
<span class="lineno">  588 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;MultiFixS&quot;,            mapsToExpl specMModule &quot;MultiFixS&quot;)</span>
<span class="lineno">  589 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;LetRecS&quot;,              mapsToExpl specMModule &quot;LetRecS&quot;)</span>
<span class="lineno">  590 </span><span class="spaces">    </span><span class="nottickedoff">{-</span>
<span class="lineno">  591 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;SpecPreRel&quot;,           mapsToExpl entreeSpecsModule &quot;SpecPreRel&quot;)</span>
<span class="lineno">  592 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;SpecPostRel&quot;,          mapsToExpl entreeSpecsModule &quot;SpecPostRel&quot;)</span>
<span class="lineno">  593 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;eqPreRel&quot;,             mapsToExpl entreeSpecsModule &quot;eqPreRel&quot;)</span>
<span class="lineno">  594 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;eqPostRel&quot;,            mapsToExpl entreeSpecsModule &quot;eqPostRel&quot;) -}</span>
<span class="lineno">  595 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;refinesS&quot;,             skip)</span>
<span class="lineno">  596 </span><span class="spaces">  </span><span class="nottickedoff">, (&quot;refinesS_eq&quot;,          skip)</span>
<span class="lineno">  597 </span><span class="spaces">  </span><span class="nottickedoff">]</span></span>
<span class="lineno">  598 </span>
<span class="lineno">  599 </span>
<span class="lineno">  600 </span>
<span class="lineno">  601 </span>escapeIdent :: Coq.Ident -&gt; Coq.Ident
<span class="lineno">  602 </span><span class="decl"><span class="nottickedoff">escapeIdent (Coq.Ident str)</span>
<span class="lineno">  603 </span><span class="spaces">  </span><span class="nottickedoff">| all okChar str = Coq.Ident str</span>
<span class="lineno">  604 </span><span class="spaces">  </span><span class="nottickedoff">| otherwise      = Coq.Ident (&quot;Op_&quot; ++ zEncodeString str)</span>
<span class="lineno">  605 </span><span class="spaces"> </span><span class="nottickedoff">where</span>
<span class="lineno">  606 </span><span class="spaces">   </span><span class="nottickedoff">okChar x = isAlphaNum x || x `elem` (&quot;_'&quot; :: String)</span></span>
<span class="lineno">  607 </span>
<span class="lineno">  608 </span>zipSnippet :: String
<span class="lineno">  609 </span><span class="decl"><span class="nottickedoff">zipSnippet = [i|</span>
<span class="lineno">  610 </span><span class="spaces"></span><span class="nottickedoff">Fixpoint zip (a b : sort 0) (m n : nat) (xs : Vec m a) (ys : Vec n b)</span>
<span class="lineno">  611 </span><span class="spaces">  </span><span class="nottickedoff">: Vec (minNat m n) (a * b) :=</span>
<span class="lineno">  612 </span><span class="spaces">  </span><span class="nottickedoff">match</span>
<span class="lineno">  613 </span><span class="spaces">    </span><span class="nottickedoff">xs in Vector.t _ m'</span>
<span class="lineno">  614 </span><span class="spaces">    </span><span class="nottickedoff">return Vector.t _ (minNat m' n)</span>
<span class="lineno">  615 </span><span class="spaces">  </span><span class="nottickedoff">with</span>
<span class="lineno">  616 </span><span class="spaces">  </span><span class="nottickedoff">| Vector.nil =&gt; Vector.nil _</span>
<span class="lineno">  617 </span><span class="spaces">  </span><span class="nottickedoff">| Vector.cons x pm xs =&gt;</span>
<span class="lineno">  618 </span><span class="spaces">    </span><span class="nottickedoff">match</span>
<span class="lineno">  619 </span><span class="spaces">      </span><span class="nottickedoff">ys in Vector.t _ n'</span>
<span class="lineno">  620 </span><span class="spaces">      </span><span class="nottickedoff">return Vector.t _ (minNat (S pm) n')</span>
<span class="lineno">  621 </span><span class="spaces">    </span><span class="nottickedoff">with</span>
<span class="lineno">  622 </span><span class="spaces">    </span><span class="nottickedoff">| Vector.nil =&gt; Vector.nil _</span>
<span class="lineno">  623 </span><span class="spaces">    </span><span class="nottickedoff">| Vector.cons y pm' ys =&gt; Vector.cons _ (x, y) _ (zip _ _ _ _ xs ys)</span>
<span class="lineno">  624 </span><span class="spaces">    </span><span class="nottickedoff">end</span>
<span class="lineno">  625 </span><span class="spaces">  </span><span class="nottickedoff">end</span>
<span class="lineno">  626 </span><span class="spaces"></span><span class="nottickedoff">.</span>
<span class="lineno">  627 </span><span class="spaces"></span><span class="nottickedoff">|]</span></span>

</pre>
</body>
</html>
